<?xml version="1.0" encoding="UTF-8"?>

<component name="com.aritu.eloraplm.change.management.ActionService.contrib">

  <extension target="org.nuxeo.ecm.platform.actions.ActionService" point="filters">

    <filter append="true" id="create">
      <rule grant="true">
        <permission>AddChildren</permission>
        <type>FolderChangeManagementPR</type>
        <type>FolderChangeManagementECR</type>
        <type>FolderChangeManagementECO</type>
        <type>CmPr</type>
        <type>CmEcr</type>
        <type>CmEco</type>
      </rule>
    </filter>

    <filter append="true" id="viewSummaryTab">
      <rule grant="true">
        <type>CmPr</type>
        <type>CmEcr</type>
        <type>CmEco</type>
      </rule>
    </filter>
    
    <filter id="isCm">
      <rule grant="true">
        <type>CmPr</type>
        <type>CmEcr</type>
        <type>CmEco</type>
      </rule>
    </filter>
    
    <filter id="isCmPr">
	    <rule grant="true">
	      <type>CmPr</type>
	    </rule>
    </filter>
    
    <filter id="isCmEcr">
      <rule grant="true">
        <type>CmEcr</type>
      </rule>
    </filter>
    
    <filter id="isCmEco">
      <rule grant="true">
        <type>CmEco</type>
      </rule>
    </filter>

    <filter id="viewModifiedItemsTab">
        <rule grant="true">
          <type>CmEco</type>
          <type>CmEcr</type>
        </rule>
    </filter>
    
    <filter id="viewBomsImpactMatrixTab">
        <rule grant="true">
          <type>CmEco</type>
          <type>CmEcr</type>
        </rule>
    </filter>
    
    <filter id="viewDocsImpactMatrixTab">
        <rule grant="true">
          <type>CmEco</type>
          <type>CmEcr</type>
        </rule>
    </filter>
    

    <filter id="filter@wf@wf_CmPr">
      <rule grant="true">
        <permission>ReadWrite</permission>
        <type>CmPr</type>
      </rule>
    </filter>
    
    
    <filter id="cmModifiedItemsTreeButtons">
        <rule grant="true">
            <permission>Write</permission>
            <type>CmEcr</type>
            <type>CmEco</type>
            <condition>#{webActions.currentTabId eq 'TAB_CM_MODIFIED_ITEMS_TREETABLE'}</condition>
        </rule>
        <rule grant="false"><!-- TODO:: BEGIRATU KONDIZIO HAUEK ??? -->
            <condition>#{currentDocument.isVersion()}</condition>
            <condition>#{currentDocument.isProxy()}</condition>
        </rule>
    </filter>
    
    <filter id="cmBomImpactedItemsTreeButtons">
        <rule grant="true">
            <permission>Write</permission>
            <type>CmEcr</type>
            <type>CmEco</type>
            <condition>#{webActions.currentTabId eq 'TAB_CM_BOM_IMPACTED_ITEMS_TREETABLE'}</condition>
        </rule>
        <rule grant="false"><!-- TODO:: BEGIRATU KONDIZIO HAUEK ??? -->
            <condition>#{currentDocument.isVersion()}</condition>
            <condition>#{currentDocument.isProxy()}</condition>
        </rule>
    </filter>
    
    <filter id="cmDocImpactedItemsTreeButtons">
        <rule grant="true">
            <permission>Write</permission>
            <type>CmEcr</type>
            <type>CmEco</type>
            <condition>#{webActions.currentTabId eq 'TAB_CM_DOC_IMPACTED_ITEMS_TREETABLE'}</condition>
        </rule>
        <rule grant="false"><!-- TODO:: BEGIRATU KONDIZIO HAUEK ??? -->
            <condition>#{currentDocument.isVersion()}</condition>
            <condition>#{currentDocument.isProxy()}</condition>
        </rule>
    </filter>

  </extension>


  <extension target="org.nuxeo.ecm.platform.actions.ActionService" point="actions">

    <action accessKey="v" icon="/icons/file.gif" id="TAB_CM" label="action.view.summary" link="/incl/tabs/document_view.xhtml" order="0" type="rest_document_link">
      <category>VIEW_ACTION_LIST</category>
      <filter-id>viewSummaryTab</filter-id>
      <properties>
        <property name="ajaxSupport">true</property>
      </properties>
    </action>
    
    
    <action id="TAB_CM_MODIFIED_ITEMS_TREETABLE" link="/incl/tabs/cm_modified_items.xhtml"
      order="30" label="label.com.aritu.eloraplm.cm.tab.modifiedItems" type="rest_document_link">
      <category>VIEW_ACTION_LIST</category>
      <filter-id>viewModifiedItemsTab</filter-id>
    </action>
    
    <action id="TAB_CM_BOM_IMPACTED_ITEMS_TREETABLE" link="/incl/tabs/cm_bom_impacted_items.xhtml"
      order="33" label="label.com.aritu.eloraplm.cm.tab.bomImpactedItems" type="rest_document_link">
      <category>VIEW_ACTION_LIST</category>
      <filter-id>viewBomsImpactMatrixTab</filter-id>
    </action>
    
    <action id="TAB_CM_DOC_IMPACTED_ITEMS_TREETABLE" link="/incl/tabs/cm_doc_impacted_items.xhtml"
      order="35" label="label.com.aritu.eloraplm.cm.tab.docImpactedItems" type="rest_document_link">
      <category>VIEW_ACTION_LIST</category>
      <filter-id>viewDocsImpactMatrixTab</filter-id>
    </action>
    
    
    <action id="TAB_CM_RELATED_PROCESS" link="/incl/tabs/cm_related_process.xhtml" order="40" 
      label="label.com.aritu.eloraplm.cm.tab.relatedProcess" type="rest_document_link">
      <category>VIEW_ACTION_LIST</category>
      <filter-id>isCm</filter-id>
    </action>
    
    <!-- Treetable buttons -->
    
     <!-- Modified and impacted items Treetable related buttons -->
    <action id="BtnAddModifiedItem" order="10" label="eloraplm.command.cm.modifiedItem.add" type="fancybox" icon="">
      <category>TREETABLE_BUTTON</category>
      <filter-id>cmModifiedItemsTreeButtons</filter-id>
      <properties>
        <property name="width">800</property>
        <property name="height">800</property>
        <property name="autoDimensions">false</property>
        <property name="include">/incl/action/cm_add_modified_item.xhtml</property>
        <property name="addForm">true</property>
        <property name="ajaxSupport">true</property>
        <property name="styleClass">button</property>
      </properties>
    </action>
    
    <action id="BtnSaveModifiedItemsTreetable" order="20" label="command.save" type="link" link="#{cmModifiedItemsTreeBean.saveTree}" icon="">
      <category>TREETABLE_BUTTON</category>
      <filter-id>cmModifiedItemsTreeButtons</filter-id>
      <properties>
        <property name="addForm">true</property>
        <property name="ajaxSupport">true</property>
        <property name="styleClass">button</property>
      </properties>
    </action>
    
    <action id="BtnSaveBomImpactedItemsTreetable" order="20" label="command.save" type="link" link="#{cmBomImpactedItemsTreeBean.saveTree}" icon="">
      <category>TREETABLE_BUTTON</category>
      <filter-id>cmBomImpactedItemsTreeButtons</filter-id>
      <properties>
        <property name="addForm">true</property>
        <property name="ajaxSupport">true</property>
        <property name="styleClass">button</property>
      </properties>
    </action> 
    
    <action id="BtnSaveDocImpactedItemsTreetable" order="20" label="command.save" type="link" link="#{cmDocImpactedItemsTreeBean.saveTree}" icon="">
      <category>TREETABLE_BUTTON</category>
      <filter-id>cmDocImpactedItemsTreeButtons</filter-id>
      <properties>
        <property name="addForm">true</property>
        <property name="ajaxSupport">true</property>
        <property name="styleClass">button</property>
      </properties>
    </action> 
    
    
    <!-- Process relations Tab buttons -->
    
    <action id="BtnAddPRRelation" order="20" label="eloraplm.command.relation.add.isManagedIn" type="fancybox" icon="">
      <category>CM_PROCESS_RELATION_BUTTON</category>
      <filter-id>isCmPr</filter-id>
      <properties>
        <property name="include">/incl/action/cm_pr_add_relation.xhtml</property>
        <property name="ajaxSupport">true</property>
        <property name="styleClass">button</property>
        <property name="addForm">true</property>
      </properties>
    </action>
    
    <action id="BtnAddECRRelation" order="20" label="eloraplm.command.relation.add.isManagedIn" type="fancybox" icon="">
      <category>CM_PROCESS_RELATION_BUTTON</category>
      <filter-id>isCmEcr</filter-id>
      <properties>
        <property name="include">/incl/action/cm_ecr_add_relation.xhtml</property>
        <property name="ajaxSupport">true</property>
        <property name="styleClass">button</property>
        <property name="addForm">true</property>
      </properties>
    </action>
    
    <action id="BtnAddECORelation" order="20" label="eloraplm.command.relation.add.isManagedIn" type="fancybox" icon="">
      <category>CM_PROCESS_RELATION_BUTTON</category>
      <filter-id>isCmEco</filter-id>
      <properties>
        <property name="include">/incl/action/cm_eco_add_relation.xhtml</property>
        <property name="ajaxSupport">true</property>
        <property name="styleClass">button</property>
        <property name="addForm">true</property>
      </properties>
    </action>
    
    <!-- End of Process relations Tab buttons -->
    
    <!-- Default actions on summary right panel -->
    
    <action id="summary_cm_source_documents" type="widget" order="100">
      <category>SUMMARY_PANEL_RIGHT</category>
      <properties>
        <property name="widgetName">summary_cm_source_documents</property>
      </properties>
      <filter-id>isCm</filter-id>
<!--       TODO: Hay que filtrar por lo de abajo para que no cree una capa el action sin nada dentro. Por ahora no consegimos que funcione -->
<!--       <filter id="filter@summary_cm_origin_documents"> -->
<!--         <rule grant="true">#{empty cmECRRelationBean.incomingECRStatementsInfo}</rule> -->
<!--       </filter> -->
    </action>
    
    <action id="summary_cm_target_documents" type="widget" order="200">
      <category>SUMMARY_PANEL_RIGHT</category>
      <properties>
        <property name="widgetName">summary_cm_target_documents</property>
      </properties>
      <filter-id>isCm</filter-id>
    </action>
    
    <!-- End of Default actions on summary right panel -->

  </extension>
  
</component>
 