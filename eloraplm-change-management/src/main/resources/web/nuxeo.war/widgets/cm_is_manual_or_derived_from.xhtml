<ui:composition
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:ui="http://java.sun.com/jsf/facelets"
  xmlns:h="http://java.sun.com/jsf/html"
  xmlns:nxl="http://nuxeo.org/nxforms/layout"
  xmlns:f="http://java.sun.com/jsf/core"
  xmlns:c="http://java.sun.com/jstl/core"
  xmlns:nxu="http://nuxeo.org/nxweb/util"
  xmlns:nxd="http://nuxeo.org/nxweb/document">
  
    <!--  if is manual -->
    <ui:fragment rendered="#{field_0}">
        <nxl:widget name="is_manual" mode="view" value="#{value}"/>
    </ui:fragment>
    
    <!--  if is derived from another item -->
    <ui:fragment rendered="#{!field_0}">
    
        <nxu:set var="messageTitle" value="#{field_1.elo.reference} - #{field_1.title}" />

        <ui:fragment rendered="#{field_2}">
            <nxu:set var="existDerivedFromInCmProcessAsImpactedItem" value="#{cmActionsBean.existImpactedItemInCMProcess(currentDocument.id, field_1.id)}">
            
                <ui:fragment rendered="#{existDerivedFromInCmProcessAsImpactedItem}">
                    <nxd:restDocumentLink document="#{field_1}">
                        <h:graphicImage value="/icons/cm_derived_from_16.png" style="vertical-align: middle;">
                            <f:attribute name="title" value="#{nxu:translate(messages['eloraplm.label.cm.derivedFromExistAsImpactedItem'], messageTitle)}" />
                            <f:attribute name="styleClass" value="tipsyShow" />
                        </h:graphicImage>
                    </nxd:restDocumentLink>
                </ui:fragment>
                
                <ui:fragment rendered="#{!existDerivedFromInCmProcessAsImpactedItem}">
                    <nxd:restDocumentLink document="#{field_1}">
                        <h:graphicImage value="/icons/cm_derived_from_not_in_cm_process_16.png" style="vertical-align: middle;">
                            <f:attribute name="title" value="#{nxu:translate(messages['eloraplm.label.cm.derivedFromNotExistAsImpactedItem'], messageTitle)}" />
                            <f:attribute name="styleClass" value="tipsyShow" />
                        </h:graphicImage>
                    </nxd:restDocumentLink>
                </ui:fragment>
            </nxu:set>
        </ui:fragment>
        
        <ui:fragment rendered="#{!field_2}">
            <nxu:set var="existDerivedFromInCmProcessAsModifiedItem" value="#{cmActionsBean.existModifiedItemInCMProcess(currentDocument.id, field_1.id)}" >
                <ui:fragment rendered="#{existDerivedFromInCmProcessAsModifiedItem}">
                    <nxd:restDocumentLink document="#{field_1}">
                        <h:graphicImage value="/icons/cm_derived_from_16.png" style="vertical-align: middle;">
                            <f:attribute name="title" value="#{nxu:translate(messages['eloraplm.label.cm.derivedFromExistAsModifiedItem'], messageTitle)}" />
                            <f:attribute name="styleClass" value="tipsyShow" />
                        </h:graphicImage>
                    </nxd:restDocumentLink>
                </ui:fragment>
                
                <ui:fragment rendered="#{!existDerivedFromInCmProcessAsModifiedItem}">
                    <nxd:restDocumentLink document="#{field_1}">
                        <h:graphicImage value="/icons/cm_derived_from_not_in_cm_process_16.png" style="vertical-align: middle;">
                            <f:attribute name="title" value="#{nxu:translate(messages['eloraplm.label.cm.derivedFromNotExistAsModifiedItem'], messageTitle)}" />
                            <f:attribute name="styleClass" value="tipsyShow" />
                        </h:graphicImage>
                    </nxd:restDocumentLink>
                </ui:fragment>
            </nxu:set>
        </ui:fragment>
        
    </ui:fragment>
    
</ui:composition>
