<div 
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:h="http://java.sun.com/jsf/html"
  xmlns:f="http://java.sun.com/jsf/core"
  xmlns:a4j="http://richfaces.org/a4j"
  xmlns:nxl="http://nuxeo.org/nxforms/layout"
  xmlns:nxu="http://nuxeo.org/nxweb/util"
  xmlns:c="http://java.sun.com/jstl/core"
  xmlns:ui="http://java.sun.com/jsf/facelets">

  <h3>
    <h:outputText value="#{messages['eloraplm.title.cm.modifiedItem.add']}" />
  </h3>

  <h:form id="#{fancyboxFormId}">

    <h:panelGroup styleClass="content" layout="block">
      <!--  title -->
      <h:panelGroup>
        <h:outputLabel value="#{messages['eloraplm.label.cm.process']}:" />
        <strong><h:outputText value="#{currentDocument.elo.reference} - #{currentDocument.title}" /></strong>
      </h:panelGroup>
      
      <!--  content -->
      <h:panelGroup>
        <a4j:outputPanel>

            <br/><br/>
            <table class="addModifiedItemTable">
            <!-- ################### origin item ################### -->
              <tr>
                <td class="labelColumn"><strong><h:outputLabel value="#{messages['eloraplm.label.cm.origin']}:" /></strong></td>
                <td class="fieldColumn">
                  <h:panelGroup id="originItemWcUidPanel">
                    <nxl:widgetType name="eloraSingleDocumentSuggestion" mode="edit"
                      ajaxReRender="originItemWcUidMsg originItemRealUidPanel actionPanelLabel actionPanel destinationItemPanelLabel destinationItemPanel"
                      value="#{cmModifiedItemsTreeBean}" 
                      field="originItemWcUid"
                      translated="true"
                      width="100%"
                      placeholder="eloraplm.placeholder.suggestion.cm.originItem"
                      pageProviderName="cad_bom_wc_document_suggestion"
                      required="true">
                    </nxl:widgetType>
                    <h:message for="originItemWcUid" class="errorMessage" id="originItemWcUidMsg" />
                  </h:panelGroup>
                  
                  <h:panelGroup id="originItemRealUidPanel">
                    <ui:fragment rendered="#{cmModifiedItemsTreeBean.originItemWcUid != null}">
                      <h:selectOneListbox id="originItemRealUid"
                        styleClass="dataInputText"
                        size="1"
                        value="#{cmModifiedItemsTreeBean.originItemRealUid}"
                        validator="#{cmModifiedItemsTreeBean.validateModificationOriginValue}">
                
                        <f:selectItem itemValue="#{null}" itemLabel="#{messages['eloraplm.placeholder.suggestion.cm.version']}" />
                        <nxu:selectItems value="#{cmModifiedItemsTreeBean.originItemVersionList}"
                          var="version" itemValue="#{version.key}"
                          itemLabel="#{version.value}" />
                  
                        <f:ajax event="change" execute="@this" render="originItemWcUidPanel originItemRealUidMsg actionPanelLabel actionPanel destinationItemPanelLabel destinationItemPanel"/>
                      </h:selectOneListbox>
                      <h:message for="originItemRealUid" class="errorMessage" id="originItemRealUidMsg" />
                      
                      
                    </ui:fragment>
                  </h:panelGroup>
                </td>
              </tr>
              <!-- ################### action selection ################### -->
              <tr>
                <td class="labelColumn">
                  <h:panelGroup id="actionPanelLabel">
                    <ui:fragment rendered="#{cmModifiedItemsTreeBean.originItemRealUid != null}">
                      <strong><h:outputLabel value="#{messages['eloraplm.label.cm.action']}:" /></strong>
                    </ui:fragment>
                  </h:panelGroup>
                </td>
                <td class="fieldColumn">
                  <h:panelGroup id="actionPanel">
                    <ui:fragment rendered="#{cmModifiedItemsTreeBean.originItemRealUid != null}">
                      <nxl:widgetType name="selectOneDirectory" mode="edit"
                        value="#{cmModifiedItemsTreeBean.action}" 
                        directoryName="elora_cmActionModified" 
                        localize="true" 
                        displayIdAndLabel="false" 
                        style="min-width: 10em;"
                        notDisplayDefaultOption="true"
                        required="true">
                        <f:ajax event="change" execute="@this" render="destinationItemPanelLabel destinationItemPanel"/>
                       </nxl:widgetType>
                     </ui:fragment>
                  </h:panelGroup>
                </td>
              </tr>
              <!--   ########### destination item ########### -->
              <tr>
                <td class="labelColumn">
                  <h:panelGroup id="destinationItemPanelLabel">
                    <ui:fragment rendered="#{cmModifiedItemsTreeBean.action != null}">
                      <strong><h:outputLabel value="#{messages['eloraplm.label.cm.destination']}:" /></strong>
                    </ui:fragment>
                  </h:panelGroup>
                </td>
                <td class="fieldColumn">
                  <h:panelGroup id="destinationItemPanel">
                    <!-- if action == replace, display destination item selection and destination item version selection -->
                    <ui:fragment rendered="#{cmModifiedItemsTreeBean.action eq 'id_replace'}">
                     <nxu:set var="pageProviderName" value="#{cmModifiedItemsTreeBean.originItemType eq 'BOM' ? 'bom_wc_document_suggestion' : 'cad_wc_document_suggestion'}">
                        <nxl:widgetType name="eloraSingleDocumentSuggestion" mode="edit"
                            ajaxReRender="destinationItemRealUidPanel"
                            value="#{cmModifiedItemsTreeBean}" 
                            field="destinationItemWcUid"
                            translated="true"
                            width="100%"
                            placeholder="eloraplm.placeholder.suggestion.cm.destinationItem"
                            pageProviderName="#{pageProviderName}"
                            required="true">
                        </nxl:widgetType>
                        <h:message for="destinationItemWcUid" class="errorMessage" />
                        
                        <h:panelGroup id="destinationItemRealUidPanel">
                          <h:selectOneListbox id="destinationItemRealUid"
                              styleClass="dataInputText"
                              size="1"
                              value="#{cmModifiedItemsTreeBean.destinationItemRealUid}"
                              validator="#{cmModifiedItemsTreeBean.validateModificationDestinationValue}">
                            <f:selectItem itemValue="" itemLabel="#{messages['eloraplm.placeholder.suggestion.cm.version']}" />
                            <nxu:selectItems value="#{cmModifiedItemsTreeBean.destinationItemVersionList}"
                                var="version" itemValue="#{version.key}"
                                itemLabel="#{version.value}" />
                            <f:ajax event="change" execute="@this" render="destinationItemRealUidMsg"/>
                          </h:selectOneListbox>
                          <h:message for="destinationItemRealUid" class="errorMessage" id="destinationItemRealUidMsg" />
                        </h:panelGroup>
                      </nxu:set>
                    </ui:fragment>
                    <!-- if action == replace, display destination item in read mode -->
                    <ui:fragment rendered="#{not (cmModifiedItemsTreeBean.action eq 'id_replace') and cmModifiedItemsTreeBean.action != null}">
                      <nxl:widget name="cm_destination_item" mode="view" value="#{cmModifiedItemsTreeBean}" />
                    </ui:fragment>
                  </h:panelGroup>
                </td>
              </tr>
            </table>
          
        </a4j:outputPanel>
      </h:panelGroup>
    </h:panelGroup>
    
    <div class="buttonsGadget">
      <h:commandButton value="#{messages['command.add']}" styleClass="button" action="#{cmModifiedItemsTreeBean.addModifiedItem}">
      </h:commandButton>
      
      <h:commandButton value="#{messages['command.cancel']}" styleClass="button" actionListener="#{cmModifiedItemsTreeBean.cancelActionListener}">
        <f:ajax execute="@this" onevent="jQuery.fancybox.close"/>
      </h:commandButton>

    </div>

  </h:form>

</div>