!function(){function eloraPassQueryTermsTwice(e,a,r){return e.searchTerm=[r.term,r.term],e}function escapeHTML(e){return String(e).replace(/[&<>"'\/]/g,function(e){return entityMap[e]})}function warnMessage(e){var a="";return e.warn_message&&(a+="<img src='"+window.nxContextPath+"/icons/warning.gif' title='"+e.warn_message+"'/>"),a}function userEntryDefaultFormatter(e){var a="";return e.displayIcon&&e.type&&("USER_TYPE"==e.type?a+="<img src='"+window.nxContextPath+"/icons/user.png' class='smallIcon' />":"GROUP_TYPE"==e.type&&(a+="<img src='"+window.nxContextPath+"/icons/group.png' class='smallIcon' />")),a+=escapeHTML(e.displayLabel),a+="&nbsp;<span class='detail'>"+e.id+"</span>",a+=warnMessage(e)}function docEntryWithoutStateFormatter(e){var a="<table><tbody>";return a+="<tr><td style='width: 24px'>",e.properties&&(e.properties["templ:isTemplate"]&&(a+="<img src='"+window.nxContextPath+"/icons/badge_template_12.png' class='smallIcon' />",a+="</td><td style='width: 24px'>"),e.properties["common:icon"]&&(a+="<img src='"+window.nxContextPath+e.properties["common:icon"]+"' class='smallIcon' />",a+="</td><td>"),e.properties["elo:reference"]&&(a+="<span class='eloraReference'>"+escapeHTML(e.properties["elo:reference"])+"</span>")),a+=escapeHTML(e.title),a+=warnMessage(e),e.path&&(a+="<span class='displayB detail' style='word-break:break-all;'>"+escapeHTML(e.path)+"</span>"),a+="</td></tr></tbody></table>"}function docEntryWithStateFormatter(e){var a="<table><tbody>";return a+="<tr><td style='width: 24px'>",e.properties&&(e.properties["templ:isTemplate"]&&(a+="<img src='"+window.nxContextPath+"/icons/badge_template_12.png' class='smallIcon' />",a+="</td><td style='width: 24px'>"),e.properties["common:icon"]&&(a+="<img src='"+window.nxContextPath+e.properties["common:icon"]+"' class='smallIcon' />",a+="</td><td>"),e.properties["elo:reference"]&&(a+="<span class='eloraReference'>"+escapeHTML(e.properties["elo:reference"])+"</span>")),a+=escapeHTML(e.title),a+="&nbsp;&nbsp;&nbsp;<span class='lifeCycleStateLabel hollow' style='color: "+ getLifecycleStateColor(e.state) + ";border-color:"+ getLifecycleStateColor(e.state) + "' title='" + getLifecycleStateName(e.state) + "'>"+ getLifecycleStateAbbr(e.state) + "</span>",a+=warnMessage(e),e.path&&(a+="<span class='displayB detail' style='word-break:break-all;'>"+escapeHTML(e.path)+"</span>"),a+="</td></tr></tbody></table>"}function docEntryDefaultFormatter(e){return docEntryWithStateFormatter(e)}function dirEntryDefaultFormatter(e){var a=escapeHTML(e.displayLabel);return a+=warnMessage(e)}function docSelectionWithoutStateFormatter(e){var a="";return e.properties&&(e.properties["templ:isTemplate"]&&(a+="<img src='"+window.nxContextPath+"/icons/badge_template_12.png' class='smallIcon' />"),e.properties["common:icon"]&&(a+="<img src='"+window.nxContextPath+e.properties["common:icon"]+"' class='smallIcon' />"),e.properties["elo:reference"]&&(a+="<span class='eloraReference'>"+escapeHTML(e.properties["elo:reference"])+"</span>")),a+=getDocLinkElt(e),a+=warnMessage(e)}function docSelectionWithStateFormatter(e){var a="";return e.properties&&(e.properties["templ:isTemplate"]&&(a+="<img src='"+window.nxContextPath+"/icons/badge_template_12.png' class='smallIcon' />"),e.properties["common:icon"]&&(a+="<img src='"+window.nxContextPath+e.properties["common:icon"]+"' class='smallIcon' />"),e.properties["elo:reference"]&&(a+="<span class='eloraReference'>"+escapeHTML(e.properties["elo:reference"])+"</span>")),a+=getDocLinkElt(e),a+="&nbsp;&nbsp;&nbsp;<span class='lifeCycleStateLabel hollow' style='color: "+ getLifecycleStateColor(e.state) + ";border-color:"+ getLifecycleStateColor(e.state) + "' title='" + getLifecycleStateName(e.state) + "'>"+ getLifecycleStateAbbr(e.state) + "</span>",a+=warnMessage(e)}function docSelectionDefaultFormatter(e){return docSelectionWithStateFormatter(e)}function dirSelectionDefaultFormatter(e){var a=escapeHTML(e.absoluteLabel);return a+=warnMessage(e)}function getOperationName(e){var a=e.operationId;return void 0!==a&&""!=a||(a=e.directoryName&&e.directoryName.length>0?"Directory.SuggestEntries":"Repository.PageProvider"),a}function getDocLinkElt(e){if(e.contextParameters){var a=e.contextParameters.documentURL+"?tabIds=MAIN_TABS:documents,:";return"<a href="+a+" onclick='if(!(event.ctrlKey||event.metaKey||event.button==1)){this.href='"+getUrlWithConversationId(a)+"'}'>"+escapeHTML(e.title)+"</a>"}return escapeHTML(e.title)}function getUrlWithConversationId(e){return e+"&amp;conversationId="+currentConversationId}function configureOperationParameters(op,params,query){var restoreSeamCtx="true"==params.restoreSeamCtx,temp={};jQuery.extend(temp,params),temp.lang=currentUserLang,"Directory.SuggestEntries"==params.operationId?temp.searchTerm=query.term:"UserGroup.Suggestion"==params.operationId?(temp.searchTerm=query.term,temp.searchType=params.userSuggestionSearchType):"Repository.PageProvider"==params.operationId?(temp.searchTerm=query.term,temp.query=params.query,temp.providerName=params.pageProviderName,temp.page="0",temp.pageSize="20",void 0===temp.quotePatternParameters&&(temp.quotePatternParameters=!1)):temp.searchTerm=query.term,params.additionalOperationParameters&&params.additionalOperationParameters.length>0&&(additionalParamsFunction=eval(params.additionalOperationParameters),temp=additionalParamsFunction(temp,params,query)),restoreSeamCtx&&"undefined"!=typeof currentConversationId?(op.addParameter("id",getOperationName(params)),op.addParameter("conversationId",currentConversationId),op.opts.automationParams.context=temp):op.addParameters(temp)}function fillResult(e,a,r){if(void 0!==a.length)for(i=0;i<a.length;i++){var t=a[i];e.push(t)}else if(void 0!==a.entries)for(i=0;i<a.entries.length;i++){var n=a.entries[i];e.push(n)}else alert("Error with suggestion widget")}function getDefaultLabel(e){return escapeHTML(e.displayLabel?e.displayLabel:e.title)}function getDefaultId(e){return e.computedId?e.computedId:e.uid?e.uid:e.id}function initSelect2Widget(el){if(!el.data("s2Done")){el.data("s2Done",!0);var elid=el.attr("id"),params={},paramId=(elid+"_params").split(":").join("\\:"),paramsHolder=jQuery("#"+paramId),val=paramsHolder.val();if(val){params=JSON.parse(paramsHolder.val());var readonly="true"==params.readonly,required="true"==params.required,restoreSeamCtx="true"==params.restoreSeamCtx,initId=(elid+"_init").split(":").join("\\:"),initHolder=jQuery("#"+initId),initDoc=null;try{initDoc=JSON.parse(initHolder.val())}catch(e){}el.css("width",params.width);var opName=getOperationName(params),automationParams={documentSchemas:params.documentSchemas};params.repository&&(automationParams.repository=params.repository);var op=null;op=restoreSeamCtx&&"undefined"!=typeof currentConversationId?jQuery().automation("WebUI.RunOperationInSeam",automationParams):jQuery().automation(opName,automationParams);var selectionFormatterFunction=null;params.selectionFormatter&&params.selectionFormatter.length>0&&(selectionFormatterFunction=eval(params.selectionFormatter));var suggestionFormatterFunction=null;params.suggestionFormatter&&params.suggestionFormatter.length>0&&(suggestionFormatterFunction=eval(params.suggestionFormatter));var enterKeyHandlerFunction=null;params.onEnterKeyHandler&&params.onEnterKeyHandler.length>0&&(enterKeyHandlerFunction=eval(params.onEnterKeyHandler));var requestInProgress=!1,nextQueryId,select2_params={containerCssClass:params.containerCssClass,dropdownCssClass:params.dropdownCssClass,minimumInputLength:params.minChars,autocomplete:params.autocomplete,query:function(e){var a=function(){requestInProgress?(window.clearTimeout(nextQueryId),nextQueryId=window.setTimeout(function(){a()},100)):(requestInProgress=!0,configureOperationParameters(op,params,e),op.execute(function(a,r,t){var n=[];fillResult(n,a,params),e.callback({results:n}),requestInProgress=!1},function(e,a,r){500==e.status&&alert("Error while querying data from server: "+a),requestInProgress=!1}))};window.clearTimeout(nextQueryId),nextQueryId=window.setTimeout(function(){a()},300)}};select2_params.formatSelection=null!=selectionFormatterFunction?selectionFormatterFunction:function(e){return null!=select2_params.labelFieldName?escapeHTML(e.properties[select2_params.labelFieldName]):getDefaultLabel(e)},select2_params.formatResult=null!=suggestionFormatterFunction?suggestionFormatterFunction:getDefaultLabel,null!=enterKeyHandlerFunction&&(select2_params.enterKeyHandler=enterKeyHandlerFunction),params.idProperty&&params.idProperty.length>0?select2_params.id=function(e){return e.properties[params.idProperty]}:params.idFunction?select2_params.id=eval(params.idFunction):"true"==params.prefixed?select2_params.id=function(e){return e.prefixed_id}:select2_params.id=getDefaultId,null!=initDoc&&(select2_params.initSelection=function(e,a){a(initDoc)}),"true"==params.multiple&&(select2_params.maximumSelectionSize=params.maximumSelectionSize,select2_params.multiple=!0),params.placeholder&&!readonly&&(select2_params.placeholder=params.placeholder,select2_params.allowClear=!required);var createSearchChoice=null;params.createSearchChoice&&params.createSearchChoice.length>0&&(createSearchChoice=eval(params.createSearchChoice)),null!=createSearchChoice&&(select2_params.createSearchChoice=createSearchChoice),"true"==params.dropdownOnArrow&&"false"==params.multiple&&(select2_params.dropdownOnArrow=!0),params.separator&&(select2_params.separator=params.separator),el.select2(select2_params),readonly&&el.select2("readonly",!0),readonly||("true"==params.multiple&&"true"==params.orderable&&el.select2("container").find("ul.select2-choices").sortable({containment:"parent",start:function(){el.select2("onSortStart")},update:function(){el.select2("onSortEnd")}}),el.on("select2-opening",function(e){params.onclick&&eval(params.onclick)}),el.on("change",function(e){if(e){if(e.added){var newValue;if(select2_params.multiple){var newObj=JSON.parse(initHolder.val());newObj.push(e.added);var newValue=JSON.stringify(newObj)}else newValue=JSON.stringify(e.added);initHolder.val(newValue),params.onAddEntryHandler&&eval(params.onAddEntryHandler)(e.added)}if(e.removed){var removedId=select2_params.id(e.removed);if(select2_params.multiple){var newValue="",tempObj=JSON.parse(initHolder.val());jQuery.each(tempObj,function(e,a){a&&select2_params.id(a)==removedId&&tempObj.splice(e,1)}),newValue=JSON.stringify(tempObj),initHolder.val(newValue)}else initHolder.val()==removedId&&initHolder.val("");params.onRemoveEntryHandler&&window[params.onRemoveEntryHandler](e.removed)}}if(params.reRenderFunctionName&&window[params.reRenderFunctionName](),params.onchange){var onchange=eval(params.onchange);"function"==typeof onchange&&onchange(e)}}));var $parentForm=jQuery(el).closest("form");$parentForm.hasClass("safeEditEnabled")&&jQuery(el).closest("form").registerPostRestoreCallBacks(function(e){el.data("s2Done",!1),initSelect2Widget(jQuery(el))})}}}var entityMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"},userSelectionDefaultFormatter=userEntryDefaultFormatter;window.initSelect2AjaxWidget=function(e,a){var r="input[type='hidden'][id$=";null!=a&&a.length>0&&(r=r+a+"\\:"),r=r+e+"_select2]",jQuery(r).each(function(e,a){initSelect2Widget(jQuery(a))})},window.initSelect2Widgets=function(){jQuery("input[type='hidden'][id$=select2]").each(function(e,a){initSelect2Widget(jQuery(a))})}}();
